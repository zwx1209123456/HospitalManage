
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Index</title>
    <script src="~/Scripts/vue.js"></script>
    <script src="~/Scripts/axios.js"></script>
    <script src="~/Scripts/bootstrap.min.js"></script>
    <link href="~/Content/bootstrap.min.css" rel="stylesheet" />
</head>
<body>
    <div id="app">
        <table class="table table-bordered">
            <tr>
                <td>ID</td>
                <td>职务名称</td>
                <td>层级ID</td>
                <td>权限ID</td>
                <td>编辑</td>
            </tr>
            <tr v-for="item in Duty">
                <td>{{item.Id}}</td>
                <td><input type="text" v-model="item.DutyName" /></td>
                <td><input type="text" v-model="item.TierID" /></td>
                <td><input type="text" v-model="item.PowerID" /></td>
                <td>
                    <div v-if="item.Id!=''">
                        <a href="#" v-on:click="DutyDeletes(item.Id)">删除</a>
                        <a href="#" v-on:click="DutyUpdate(item.Id,item.DutyName,item.TierID,item.PowerID)">修改</a>
                    </div>
                    <div v-else>
                        <a href="#" v-on:click="add(item.DutyName,item.TierID,item.PowerID)">添加</a>
                    </div>

                </td>
            </tr>
        </table>
    </div>
</body>
</html>
<script type="text/javascript">
    var vm = new Vue({
        el: "#app",
        data: {
            Duty: []
        },
        mounted() {
            this.LoadData();
        },
        methods: {
            LoadData: function () {
                axios.get('@Url.Action("IndexShow","Duty")').then(
                    (response) => {
                        this.Duty = response.data;
                        this.Duty.push({ Id: "", DutyName: "", TierID: "", PowerID: "" });
                    },
                    (response) => {
                        alert(response.status);
                    }
                ).catch(function (response) {
                    alert(response);
                }
                )
            },
            DutyUpdates: function (Id, DutyName, TierID, PowerID) {
                axios.post('@Url.Action("DutyUpdate","Duty")', { duty: { Id: Id, DutyName: DutyName, TierID: TierID, PowerID: PowerID, } }).then(
                    (response) => {
                        console.log(response);
                        if (response.data > 0) {
                          
                            this.LoadData();
                        }
                    },
                    (response) => {
                        alert(response.status);
                    }
                ).catch(function (response) {
                    alert(response);
                });


            },
             add: function (DutyName, TierID, PowerID) {
                    axios.post('@Url.Action("DutyAdd", "Duty")', { Duty: { TierID: TierID, PowerID: PowerID, DutyName: DutyName } }).then(
                        (response) => {
                            console.log(response);
                            if (response.data > 0) {

                                this.LoadData();
                            }

                        },
                        (response) => {
                            alert(response.status);
                        }
                    ).catch(function (response) {
                        alert(response);
                    });
                },
            DutyDeletes: function (Id) {
               
                axios.post('@Url.Action("DutyDelete","Duty")', { Id: Id }).then(
                    (response) => {
                        if (response.data > 0) {
                           //alert("删除成功！！！");
                            this.LoadData();
                        }
                    },
                    (response) => {
                        alert(response.status);
                    }
                ).catch(function (response) {
                    alert(response);
                });
            },
        }
    
            })

    

</script>
@*<script type="text/javascript">
        var vm = new Vue({
            el: "#app",
            data: {
                DutyName: "",
                TierID: "",
                PowerID: "",
                all: 8, //总页数
                cur: 1//当前页码
            },
            watch: {
                cur: function (oldValue, newValue) {
                }
            },
            mounted() {
                this.getAllUser(this.cur);
            },
            methods: {
                searchUser: function (data) {
                        axios.get('@Url.Action("IndexShow", "Duty")', { params: { currentpage: 1, name: data }}).then(
                            (response) => {

                                //this.UserList = [];
                                this.cur = response.data.CurrentPage;
                                this.all = response.data.TotlePage;
                                for (var i = 0; i < response.data.PageData.length; i++) {
                                    this.UserList.push(response.data.PageData[i]);
                                }

                            },
                        (response) => {
                            alert(response.status);
                        }
                    ).catch(function (response) {
                        alert(response);
                    });
                },
                btnClick: function (data) {//页码点击事件
                    if (data != this.cur) {
                        this.cur = data;
                        this.getAllUser(data);


                    }
                },
                   pageClick: function () {
                      //console.log('现在在' + this.cur + '页');
                        this.getAllUser(this.cur);
                    },
                    getAllUser: function (id) {
                        axios.get('@Url.Action("IndexShow", "Duty")', { params: { currentpage: id }}).then(
                            (response) => {
                                this.UserList = [];
                                this.cur = response.data.CurrentPage;
                                this.all = response.data.TotlePage;
                                for (var i = 0; i < response.data.PageData.length; i++) {
                                    this.UserList.push(response.data.PageData[i]);
                                }

                            },
                            (response) => {
                                alert(response.status);
                            }
                        ).catch(function (response) {
                            alert(response);
                        });
                    },
                add: function (DutyName,TierID, PowerID,) {
                    console.log(DutyName);

                    axios.post('@Url.Action("DutyAdd", "Duty")', { Duty: { DutyName: DutyName,TierID: TierID, PowerID: PowerID } }).then(
                            (response) => {

                                this.getAllUser(1);
                                this.UserList = [];
                                for (var i = 0; i < response.data.length; i++) {
                                    this.UserList.push(response.data[i]);
                                }
                                this.UserList.push({ Id: "", Name: "", Sex: "", Role:"" });
                            },
                            (response) => {
                                alert(response.status);
                            }
                        ).catch(function (response) {
                            alert(response);
                        });
                    },
                DutyUpdate: function (id, DutyName, TierID, PowerID) {
                    axios.post('@Url.Action("DutyUpdate", "Duty")', { Duty: { Id: Id, DutyName: DutyName,TierID: TierID, PowerID: PowerID,  } }).then(
                            (response) => {
                                console.log(response);
                                if (response.data > 0) {
                                    this.getAllUser(this.cur);
                                }
                            },
                            (response) => {
                                alert(response.status);
                            }
                        ).catch(function (response) {
                            alert(response);
                        });
                    },
                DutyDelete: function (id) {
                        axios.post('@Url.Action("DutyDelete", "Duty")', { Id: Id }).then(
                            (response) => {
                                if (response.data > 0) {
                                    this.getAllUser(this.cur);
                                }
                            },
                            (response) => {
                                alert(response.status);
                            }
                        ).catch(function (response) {
                            alert(response);
                        });
                    },
                },
                //计算属性
                computed: {
                    indexs: function () {
                        var left = 1;
                        var right = this.all;
                        var ar = [];
                        if (this.all >= 5) {
                            if (this.cur > 3 && this.cur < this.all - 2) {
                                left = this.cur - 2
                                right = this.cur + 2
                            } else {
                                if (this.cur <= 3) {
                                    left = 1
                                    right = 5
                                } else {
                                    right = this.all
                                    left = this.all - 4
                                }
                            }
                        }
                        while (left <= right) {
                            ar.push(left)
                            left++
                        }
                        return ar
                    }

                }
            });


    </script>*@


